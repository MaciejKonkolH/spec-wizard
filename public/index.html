<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Spec Wizard</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="critical-error" class="hidden">
        <div class="error-box">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
                <path d="M12 9v4" />
                <path d="M12 17h.01" />
            </svg>
            <h2>Application Error</h2>
            <p id="error-msg">A critical error occurred while loading or running the application.</p>
            <div id="error-details"></div>
            <button onclick="location.reload()" class="btn primary">Reload Page</button>
        </div>
    </div>
    <script>
        function logError(msg, details) {
            const container = document.getElementById('critical-error');
            const detailsEl = document.getElementById('error-details');
            if (container) container.classList.remove('hidden');
            if (detailsEl) detailsEl.textContent = (detailsEl.textContent ? detailsEl.textContent + '\n' : '') + msg + (details ? ': ' + details : '');
        }
        window.onerror = (msg, url, line) => logError('JS Error', `${msg} at ${url}:${line}`);
        window.onunhandledrejection = (event) => logError('Promise Rejection', event.reason);
    </script>
    <div id="app">
        <header>
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path
                        d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                    </path>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                </svg>
                AI Spec Wizard
            </div>
            <div class="project-selector">
                <select id="projectSelect" class="select-modern">
                    <option value="">(Loading projects...)</option>
                </select>
            </div>
            <div class="actions">
                <button id="saveBtn" class="btn primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                        <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                    <span data-i18n="save">Save Changes</span>
                </button>
                <button id="generateBtn" class="btn magic">
                    <div class="spinner"></div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z">
                        </path>
                    </svg>
                    <span class="btn-text-gen" data-i18n="generate">Generate Next Phase</span>
                </button>
                <div class="divider"></div>
                <button id="configBtn" class="icon-only-btn" title="Settings">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                    <!-- Span for text, but hidden or tooltip-like could be better. Keeping empty/hidden text if user just wants icon, but user asked for "modern buttons". Let's removing text from Settings button to make it cleaner, or keep it. User said "icons from last century", so replacing emoji with SVG is key. -->
                </button>
                <div id="connectionStatus" class="status-dot tooltip" data-tooltip="Connecting..."></div>
            </div>
        </header>

        <main id="scroll-container">
            <div class="container main-layout">
                <div class="content-area">
                    <div id="project-header">
                        <h1 id="project-name">Loading...</h1>
                        <p id="project-desc">...</p>
                    </div>

                    <!-- Tabs for Modules -->
                    <div id="modules-nav" class="tabs">
                        <!-- Injected via JS -->
                    </div>

                    <!-- Module Info (Description) -->
                    <div id="module-info"></div>

                    <!-- Secondary Tabs for Phases -->
                    <div id="phases-nav" class="sub-tabs">
                        <!-- Injected via JS -->
                    </div>

                    <!-- Content Area -->
                    <div id="module-content" class="content-panel">
                        <!-- Injected via JS -->
                    </div>
                </div>

                <!-- Sidebar for Context -->
                <aside id="context-sidebar" class="context-panel">
                    <div class="context-header">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                        </svg>
                        <span data-i18n="project_context">Project Context</span>
                    </div>
                    <div id="global-context" class="context-section">
                        <h4>Project</h4>
                        <div class="context-text" id="global-context-text">...</div>
                    </div>
                    <div id="module-context-display" class="context-section">
                        <h4>Module</h4>
                        <div class="context-text" id="module-context-text">...</div>
                    </div>
                </aside>
            </div>

            <!-- Toast/Status-bar floating or integrated? User said REMOVE footer. -->
            <div id="status-toast" class="toast hidden"></div>
        </main>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content">
            <h2>Settings</h2>
            <!-- Need updateUIText to handle title if no data-i18n, but app.js handles it via TRANSLATIONS.settings_title -->
            <div class="form-group">
                <label data-i18n="settings_language">Language:</label>
                <select id="langSelect">
                    <option value="en">English</option>
                    <option value="pl">Polski</option>
                </select>
            </div>
            <div class="form-group">
                <label data-i18n="settings_mode">Mode:</label>
                <select id="apiModeSelect">
                    <option value="false">Agent Mode (Manual)</option>
                    <option value="true">API Mode (Automatic)</option>
                </select>
            </div>
            <div class="form-group api-only hidden">
                <label data-i18n="settings_provider">API Provider:</label>
                <select id="apiProviderSelect">
                    <option value="openai">OpenAI (GPT-4)</option>
                    <option value="gemini">Google Gemini (Flash/Pro)</option>
                    <option value="anthropic">Anthropic (Claude)</option>
                </select>
            </div>
            <div class="form-group api-only hidden">
                <label>Model Name:</label>
                <select id="apiModelSelect">
                    <option value="">(Loading models...)</option>
                </select>
            </div>
            <div class="form-group api-only hidden">
                <label data-i18n="settings_key">API Key:</label>
                <input type="password" id="apiKeyInput" placeholder="sk-...">
            </div>
            <div class="modal-actions">
                <button id="closeSettingsBtn" class="btn"><span data-i18n="close">Close</span></button>
                <button id="saveSettingsBtn" class="btn primary"><span data-i18n="save_settings">Save
                        Settings</span></button>
            </div>
        </div>
    </div>

    <script src="app.js?v=12"></script>
</body>

</html>